\documentclass[openany, 11pt]{book}

% Packages
\usepackage{graphicx}
\usepackage{fancyhdr}
\usepackage{titlesec}
\usepackage{textcase}
\usepackage{ulem}
\usepackage{tcolorbox}
\usepackage{courier}
\usepackage[margin=2.5cm, top=2cm]{geometry} % Set general page margins
\usepackage{background} % For drawing the box on every page
\usepackage{etoolbox}   % For resetting counters

% General Font
\renewcommand{\rmdefault}{pcr} % Set courier as the default font family

% Paths
\graphicspath{{./}{./images/}}

% Page Numbering
\makeatletter
\renewcommand{\thepage}{%
  \thechapter.%
  \ifnum\c@section<10 0\fi% Add leading zero if section number < 10
  \@arabic\c@section-%
  \arabic{page}%
}
\makeatother

% Reset section page numbering per chapter
\newcounter{sectioninchapter} % Counter to track sections in a chapter
\pretocmd{\chapter}{%
  \setcounter{sectioninchapter}{0} % Reset section counter for each chapter
}{}{}
\pretocmd{\section}{%
  \ifnum\value{sectioninchapter}=0
    \setcounter{page}{1} % First section stays on the same page
  \else
    \clearpage\setcounter{page}{1} % Start new page for subsequent sections
  \fi
  \stepcounter{sectioninchapter} % Increment section counter
}{}{}

% Header Layout
\setlength{\topmargin}{-2cm}      % Moves the content block closer to the top
\setlength{\headheight}{33pt}     % Adjust height of the header to fit the logo
\setlength{\headsep}{10pt}        % Space between header and main content

% Custom Header
\pagestyle{fancy}
\fancyhf{} % Clear all headers and footers
\fancyhead[L]{\includegraphics[height=1cm]{maho-logo.png}} % Logo on the left
\fancyhead[C]{\raisebox{1.2\height}{\textbf{MH 400 E}}}    % Center text
\fancyhead[R]{\raisebox{1.2\height}{\textbf{\thepage}}}    % Page number on the right
\renewcommand{\headrulewidth}{0pt} % Remove line under the header

% Custom Header on Chapter Title Pages
\fancypagestyle{plain}{%
  \fancyhf{}
  \fancyhead[L]{\includegraphics[height=1cm]{maho-logo.png}}
  \fancyhead[C]{\raisebox{1.2\height}{\textbf{MH 400 E}}}
  \fancyhead[R]{\raisebox{1.2\height}{\textbf{\thepage}}}
}

% Background Box
\backgroundsetup{%
  scale=1,
  color=black,
  opacity=1,
  angle=0,
  position=current page.south west,
  vshift=1cm,
  hshift=2cm,
  nodeanchor=south west,
  contents={%
    \begin{tikzpicture}[remember picture, overlay]
      \node[anchor=south west, inner sep=0] (box) at (0, 0) {
        \begin{tcolorbox}[
          colframe=black,
          colback=white,
          boxrule=0.5mm,
          sharp corners,
          width=\dimexpr\paperwidth-3cm\relax,
          height=\dimexpr\paperheight-3cm\relax
        ]
        \end{tcolorbox}
      };
      \draw[black, thick] ([yshift=1cm]box.south west) -- ([yshift=1cm]box.south east); % Footer line
      \node[anchor=south, yshift=-.6cm] at ([yshift=1cm]box.south) {
        \footnotesize \textit{MAHO WERKZEUGMACHINENBAU BABEL \& CO. D-8962 FRONTEN}
      };
    \end{tikzpicture}
  }
}

% Chapter Formatting
\titleformat{\chapter}[block]{\normalfont\Large\bfseries}{}{0pt}{\chapterTitleStyle}
\titlespacing*{\chapter}{0pt}{0pt}{20pt} % Adjust spacing before/after chapter title
\newcommand{\chapterTitleStyle}[1]{%
  \vspace{-1em}% Adjust vertical space
  \underline{\MakeUppercase{#1}}% Uppercase and underline the title
  \vspace{1em}% Adjust vertical space after the title
}

% Section Formatting
\titleformat{\section}[block]{\normalfont\large\bfseries}{}{0pt}{\sectionTitleStyle}
\titlespacing*{\section}{0pt}{10pt}{10pt} % Adjust spacing before/after section title
\newcommand{\sectionTitleStyle}[1]{%
  \underline{\MakeUppercase{#1}}% Uppercase and underline the section title
}

% Subsection Formatting
\titleformat{\subsection}[block]{\normalfont\normalsize\bfseries}{}{0pt}{} % No uppercase/underline
\titlespacing*{\subsection}{0pt}{10pt}{10pt}

% Document Content
\begin{document}

\chapter{Introduction}
\section{Overview}
\subsection{Subsection}
This is some subsection text.

\newpage

This is some more text.

\section{Details}
This is an example of another section content.

\chapter{Another Chapter}
\section{Overview}
This is an example of the second chapter content.

\section{Details}
This is an example of another section in the second chapter.

\end{document}